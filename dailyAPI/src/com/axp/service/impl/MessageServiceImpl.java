package com.axp.service.impl;import java.util.HashMap;import java.util.List;import java.util.Map;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import com.axp.dao.IMessageCenterDao;import com.axp.domain.MessageCenter;import com.axp.service.IMessageService;import com.axp.util.CalcUtil;import com.axp.util.JsonResponseUtil;import com.axp.util.Parameter;import com.axp.util.ParameterUtil;import com.axp.util.QueryModel;import com.axp.util.StringUtil;@Servicepublic class MessageServiceImpl extends BaseServiceImpl<MessageCenter> implements IMessageService {		@Autowired	IMessageCenterDao messageCenterDao;		@Override	public Map<String, Object> getMessageList(HttpServletRequest request, HttpServletResponse response){		String path = request.getContextPath();		String basePath = request.getScheme() + "://" + request.getServerName() + ":" + request.getServerPort() + path + "/";		String resPath = request.getServletContext().getAttribute("RESOURCE_LOCAL_URL").toString();		Parameter parameter = ParameterUtil.getParameter(request);		if (parameter == null) {//错误的参数；			return JsonResponseUtil.getJson(-0x02,"参数data不是合法的json字符串");		}				Map<String, Object> statusMap = new HashMap<String, Object>();		Integer userId = Integer.parseInt(parameter.getUserId());		Integer pageIndex = Integer.parseInt(parameter.getData().getString("pageIndex"));				QueryModel model = new QueryModel().setOrder("id desc");		model.combPreEquals("isValid", true);				int	count = dateBaseDAO.findCount(MessageCenter.class, model);		int A = (int) CalcUtil.div(count, pageItemCount);		int B = (int) CalcUtil.add(A, 1);		int totalPage = (count % pageItemCount) > 0 ? B				: A;		int C = (int) CalcUtil.sub(pageIndex, 1);		int start = (int) CalcUtil.mul(C, pageItemCount);		//int start = (pageIndex - 1) * pageItemCount;		//查询结果；		List<MessageCenter> list = dateBaseDAO.findPageList(MessageCenter.class, model,start,pageItemCount);		for(MessageCenter mc : list){			if(StringUtil.hasLength(mc.getCover())){				mc.setCover(resPath+mc.getCover());			}			mc.setUri(basePath+"invoke/users/getMessageContent?id="+mc.getId());		}				Map<String, Object> dataMap = new HashMap<String, Object>();		dataMap.put("pageIndex", pageIndex);		dataMap.put("pageSize", totalPage);		dataMap.put("pageItemCount", pageItemCount);		dataMap.put("dataList", list);		statusMap.put("status", 0x01);		statusMap.put("message", "请求成功");		statusMap.put("data", dataMap);				return statusMap;	}		@Override	public String getMessageContent(Integer id){		MessageCenter message = messageCenterDao.findById(id);		return message.getContent();	} 	}